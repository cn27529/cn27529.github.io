<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>打地鼠遊戲</title>
<!-- 引入TailwindCSS -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* 定義地鼠洞格子的大小與圓角，背景圖片調整 */
  .hole {
    width: 100px;
    height: 100px;
    border-radius: 0.5rem;
    background-size: cover;
    background-position: center;
  }
  /* 地鼠圖片大小及滑鼠指標為手形 */
  .mole {
    width: 80px;
    height: 80px;
    cursor: pointer;
  }
</style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">
  <!-- 遊戲區域，放置地鼠洞 -->
  <div id="game-area" class="flex flex-wrap justify-center gap-6 mb-6"></div>

  <!-- 遊戲控制按鈕：開始遊戲、結束遊戲 -->
  <div class="flex gap-4 mb-4">
    <button id="start-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">開始遊戲</button>
    <button id="stop-btn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">結束遊戲</button>
  </div>

  <!-- 顯示剩餘時間與分數 -->
  <div class="text-center mb-4">
    <div>時間剩餘: <span id="timer">60</span> 秒</div>
    <div>得分: <span id="score">0</span></div>
  </div>

  <script>
    // 遊戲配置設定，可以自由更改格子數、地鼠停留時間、圖片等等
    const config = {
      holeCount: 6,                // 地鼠洞格子數量
      moleStayMin: 500,            // 地鼠停留最短時間 (毫秒)
      moleStayMax: 1500,           // 地鼠停留最長時間 (毫秒)
      gameDuration: 60,            // 遊戲總時長 (秒)

      // 地鼠洞背景圖片URL，可換成其他URL
      holeBackground: 'https://i.imgur.com/3Z5VPMZ.png',
      // 地鼠圖示URL，可換成其他地鼠圖片
      moleImage: 'https://i.imgur.com/OaXyqWI.png',
      // 遊戲主題背景圖，可自由更換
      themeBackground: 'https://i.imgur.com/w1B2bXQ.jpg',
    };

    // 設定主題背景圖片，並調整背景大小填滿
    document.body.style.backgroundImage = `url(${config.themeBackground})`;
    document.body.style.backgroundSize = 'cover';

    // 取得HTML元素的引用
    const gameArea = document.getElementById('game-area');   // 地鼠洞區域
    const timerEl = document.getElementById('timer');        // 時間顯示元素
    const scoreEl = document.getElementById('score');        // 分數顯示元素
    const startBtn = document.getElementById('start-btn');   // 開始按鈕
    const stopBtn = document.getElementById('stop-btn');     // 結束按鈕

    // 遊戲狀態變數初始化
    let score = 0;                    // 計分
    let timeLeft = config.gameDuration;   // 剩餘時間
    let timerInterval = null;         // 計時器interval ID
    let moleTimeouts = [];            // 地鼠消失的timeout ID陣列
    let gameRunning = false;          // 遊戲是否進行中標記

    // 建立地鼠洞格子DOM元素
    function createHoles() {
      gameArea.innerHTML = '';  // 清空遊戲區域
      for (let i = 0; i < config.holeCount; i++) {
        const hole = document.createElement('div');
        hole.classList.add('hole');                      // 加入CSS類
        hole.style.backgroundImage = `url(${config.holeBackground})`;  // 設定洞背景圖片
        hole.dataset.index = i;                           // 設定索引，未來可用於擴充功能
        gameArea.appendChild(hole);                       // 加入到遊戲區
      }
    }

    // 地鼠隨機出現函式
    function showMole() {
      if (!gameRunning) return;  // 遊戲未開始則不執行

      const holes = document.querySelectorAll('.hole');            // 取得所有地鼠洞
      const randomIndex = Math.floor(Math.random() * holes.length); // 隨機選一個洞
      const hole = holes[randomIndex];

      if (hole.querySelector('img')) {
        // 如果該洞已有地鼠圖示，避免重複，遞迴重新呼叫
        return showMole();
      }

      // 建立地鼠圖片元素，設定地鼠圖示
      const mole = document.createElement('img');
      mole.src = config.moleImage;
      mole.classList.add('mole');

      // 點擊地鼠事件：得分加一、更新畫面分數，移除地鼠
      mole.addEventListener('click', () => {
        score++;
        scoreEl.textContent = score;
        hole.removeChild(mole);
      });

      hole.appendChild(mole);  // 插入到該洞

      // 隨機決定地鼠停留時間，介於config設定區間
      const stayTime = Math.random() * (config.moleStayMax - config.moleStayMin) + config.moleStayMin;

      // 設定timeout時間結束後地鼠自動消失，且遊戲繼續呼叫出新地鼠
      const timeoutId = setTimeout(() => {
        if (hole.contains(mole)) {
          hole.removeChild(mole);
        }
        if (gameRunning) {
          showMole();
        }
      }, stayTime);

      moleTimeouts.push(timeoutId); // 紀錄timeout ID以便遊戲結束後清除
    }

    // 遊戲計時器，倒數秒數並顯示，時間到了就停止遊戲
    function startTimer() {
      timeLeft = config.gameDuration;
      timerEl.textContent = timeLeft;

      // 每秒倒數一次，更新畫面時間
      timerInterval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;

        if (timeLeft <= 0) {
          stopGame();  // 時間到停止遊戲
        }
      }, 1000);
    }

    // 開始遊戲函式，初始化分數、時間並開始計時與地鼠出現
    function startGame() {
      if (gameRunning) return;  // 已在遊戲中則忽略
      score = 0;
      scoreEl.textContent = score;
      gameRunning = true;
      createHoles();
      startTimer();
      showMole();
    }

    // 停止遊戲函式，清空計時器與地鼠timeout，更新狀態與介面
    function stopGame() {
      gameRunning = false;
      clearInterval(timerInterval); // 清理倒數計時器
      moleTimeouts.forEach(tid => clearTimeout(tid)); // 清理所有地鼠timeout
      moleTimeouts = [];
      timerEl.textContent = 0;
    }

    // 綁定按鈕事件
    startBtn.addEventListener('click', startGame);
    stopBtn.addEventListener('click', stopGame);

    // 首頁載入時建立初始地鼠洞
    createHoles();
  </script>
</body>
</html>
